---
title: "Precision Mental Health for SUD: Contributions from Sensing and Algorithms" 
author: "John J. Curtin, Ph.D."
institute: "University of Wisconsin-Madison"
date: May 13, 2024

title-slide-attributes:
  data-background-image: https://github.com/jjcurtin/lectures/blob/main/images/smartphone_know_you.png?raw=true
  data-background-size: 35%
  data-background-repeat: no
  data-background-position: left 10% bottom 10%

format: 
  revealjs:
    scrollable: true
    chalkboard: true
    css: uwash.css
    logo: qr-code.png
include-after: |
  <script type="text/javascript">
    Reveal.on('ready', event => {
      if (event.indexh === 0) {
        document.querySelector("div.has-logo > img.slide-logo").style.display = "block";
      }
    });
    Reveal.addEventListener('slidechanged', (event) => {
      if (event.indexh === 0) {
        Reveal.configure({ slideNumber: null });
        document.querySelector("div.has-logo > img.slide-logo").style.display = "block";
      }
      if (event.indexh === 1) { 
        Reveal.configure({ slideNumber: 'c' });
        document.querySelector("div.has-logo > img.slide-logo").style.display = "none";
      }
    });
  </script>      
---

## Mental Healthcare Needs are High and Unmet 

- In 2019, [52 million]{style="color: orange;"} Americans had an active mental illness
  - More than half did not receive any treatment


::: {.notes}
We have a mental health crisis in the U.S. and it is a crisis of **unmet** high need because our delivery of mental healthcare is deeply flawed. 

In 2019, **more than half of the 52 million Americans** with an active mental illness did not receive any treatment. **More than half**!
:::

-----------------------------------------------------------------------------

## Mental Healthcare Needs are High and Unmet

- [In 2019, 52 million Americans had an active mental illness]{style="color: grey;"}
  - [More than half did not receive any treatment]{style="color: grey;"}


- [20 million]{style="color: orange;"} adults had an active substance use disorder
  - 9 out of 10 did not receive any treatment


::: {.notes}
And for the 20 million adults suffering with a substance use disorder, it was worse still.

**9 out of 10 without any treatment**
:::

-----------------------------------------------------------------------------

## Mental Healthcare Needs are High and Unmet

- [In 2019, 52 million Americans had an active mental illness]{style="color: grey;"}
  - [More than half did not receive any treatment]{style="color: grey;"}

- [20 million adults had an active substance use disorder]{style="color: grey;"}
  - [9 out of 10 did not receive any treatment]{style="color: grey;"}

- [Large treatment disparities]{style="color: orange;"} exist by race, ethnicity, geography, and income


::: {.notes}
Our failure to treat is even more troubling for vulnerable groups.  Black and LatinX adults receive mental healthcare services at only half the rate of whites.  

And similar mental healthcare disparities exist for people living in rural communities and for those with lower incomes.
:::

-----------------------------------------------------------------------------

## Mental Healthcare Needs are High and Unmet

- Failure to treat is not surprising given many treatment barriers:
  - Access
  - Availability
  - Affordability
  - Acceptability


::: {.notes}
Our failure to treat is, unfortunately, not surprising.  There are many well known barriers to receiving traditional mental healthcare.

These include problems with access that are particularly limiting for people living in rural communities

Problems with availability

Treatment costs are often prohibitive for those without health insurance 

and stigma and related issues make traditional treatments for mental illness less acceptable to some patients.  
:::

-----------------------------------------------------------------------------

## Digital Therapeutics (DTx)

- Smartphone "apps" that prevent, manage, or treat disease 

- Can augment mental health services to address barriers
  - Accessible everywhere
  - Available 24/7
  - Highly scalable (affordable?)

::: {.notes}
Fortunately, digital therapeutics are now being developed and used by patients to address many of these treatment barriers.

For those of you that are not yet familiar with this treatment modality, digital therapeutics are smartphone "apps" that are designed to prevent, manage, or treat disease, including substance use disorders and other mental illness. 

These digital therapeutics can be combined with traditional treatments to reduce barriers because they are

- Accessible everywhere

- Available everyday, 24/7

- and highlighly scalable, which may lower costs
:::

-----------------------------------------------------------------------------

## Digital Therapeutics (DTx)

- Smartphone "apps" that prevent, manage, or treat disease 

- Can augment mental health services to address barriers
  - [Accessible everywhere]{style="color: gray;"} 
  - [Available 24/7]{style="color: gray;"} 
  - [Highly scalable (affordable?)]{style="color: gray;"} 
  - Effective!

::: {.notes}
Of course, these benefits would be meaningless if digital therapeutics were not effective.

But they are.  

For example, patients with substance use disorders who use a digital therapeutic have almost double the odds of being abstinent from alcohol or other drugs

These increases in abstinence from using digital therapeutics are observed not only when compared to patients on wait lists, who have yet to gain access to treatment but also when digital therapeutics are added on top of traditional treatments for substance use disorders.

And these benefits are durable - they have been documented up to 12 months after the start of treatment.  
:::

-----------------------------------------------------------------------------

## {#beta_app data-menu-title="Image of beta app" background-image="https://dionysus.psych.wisc.edu/present/meet_faculty/images/beta_app.png" background-size="100%" background-repeat="none"}


::: {.notes}
As you likely know, these apps are in use today with patients with SUD, but I think they are still best considered beta versions relative to their full potential. 

Their power comes from easy, 24/7 access to their many supports - the treatments, tools, and services built into these smartphone apps. But this is also their Achilles heel. As the patient using these apps, you now have to tackle difficult questions like:

- When should I use them?

- For how long?

- Which of their many supports are best for me?

- And which are best for me **right now**, at this moment in time?
:::

-----------------------------------------------------------------------------

## Precision Mental Health w/ Smart DTx

- Precision mental health requires us to provide the [right treatments]{style="color: orange;"} and supports to the [right people]{style="color: orange;"} at the [right time]{style="color: orange;"}, [every time]{style="color: orange;"}

- Current DTx can already help with "every time"

- Smart DTx can address "who", "when" & "why"

  - Sensing
  - AI/Machine learning

::: {.notes}
UPDATE

These are essentially precision mental health questions about providing the right interventions and supports to the right people at the right time, every time

This next wave of digital therapeutics, lets call them smart digital therapeutics, must learn to know us well enough to recognize when we are at greatest risk for relapse and they must be smart enough to recommend the specific supports that would be most effective for us at that moment in time to prevent that relapse.

And we believe digital therapeutics can provide this personalized care if we enhance them with sensing capabilities and built-in artificial intelligence or machine learning risk prediction algorithms.
:::

-----------------------------------------------------------------------------

## Model Output: Lapses 

Lapses

- are clearly defined,
- have a temporally precise onset, and
- can serve as an early warning sign for relapse (precede and predict)

\

- "Abstinence violation effects" can increase relapse risk
- Even a single lapse can result in overdose and/or death for some drugs

::: {.notes}
[PAUSE]

So - how are we approaching this precision mental health challenge?

To start, we have begun to develop risk prediction models that focus both on **predicting** and **explaining** future lapses

Our focus is on future lapses rather than other clinically meaningful outcomes like substance use related problems or relapse for several reasons.

To start, lapses are

- Clearly defined and have a temporally precise onset
- They can serve as an early warning sign for relapse because they both precede and predict it

- Lapses are also important targets for intervention because we know that maladaptive thoughts and feelings following a lapse - often called abstinence violation effects - can start a downward spiral that leads to relapse by itself   

- And sadly, for some drugs, even a single lapse can result in overdose and death
:::

-----------------------------------------------------------------------------

## Model Inputs: Sensing

Sensing requires:

- in vivo measurement
- longitudinal
- high temporal granularity 

\

Should be:

- Consistent across platforms/devices
- Stable/Low churn
- Feasible/acceptable for long term use

::: {.notes}
UPDATE
:::

-----------------------------------------------------------------------------

## Model Inputs: Sensing

- Ecological Momentary Assessments (EMA)
- Contextualized Geolocation
- Contexualized smartphone communications

::: {.notes}
The inputs to these lapse prediction models come from feature engineering three separate but complementary sets of raw signals that can be sensed easily on any smartphone. These are

Ecological momentary assessments
Geolocation
Cellular communications meta data and text message content

Our goal is to use features from these powerful signals to develop lapse prediction models with exceptionally high temporal resolution

In other words, we aren’t looking to simply identify individuals at high risk for lapses
Instead we want to know precisely when these lapses will occur so that we can intervene to prevent them
:::

-----------------------------------------------------------------------------

## Lapse Prediction for AUD

::: {.columns}
:::: {.column width="60%"}
- 151 individuals with moderate to severe AUD
- Early in recovery (1-8 weeks)
- Committed to abstinence throughout study
- Followed with sensing for up to 3 months
  - [Ecological Momentary Assessments]{style="color: orange;"}
  - Contextualized Geolocation
  - Contexualized smartphone communications
  - (also sensed physiology, sleep, coarse self-report)
::::

:::: {.column width="40%"}
![risk1_pis.png](https://github.com/jjcurtin/lectures/blob/main/images/risk1_pis.png?raw=true)\    
![niaaa_logo.png](https://github.com/jjcurtin/lectures/blob/main/images/niaaa_logo.png?raw=true)\    
::::
:::

::: {.notes}
UPDATE NOTES

So let me transition now to describing how we are taking the first baby steps toward developing smart digital therapeutics for SUD

We have recently completed a NIAAA funded project where we collected data from 151 participants who were in early recovery from a moderate to severe alcohol use disorder.  

These participants were committed to abstinence at the start of the study and we followed them for up to 3 months, collecting a variety of active and passive personal sensing data streams.

Our first goal with this grant was to develop machine learning algorithms that can generate temporally precise predictions about when future lapses back to alcohol use will occur for patients with AUD.

We are in the early stages of model building at this point and I will focus today on results from preliminary models using only EMA.  However, we are actively working with GPS and cellular communications as well and I’ll end with some brief discussion of those preliminary models, as well as early plans on how to implement these models clinically to help patients.
:::

-----------------------------------------------------------------------------

## Participant Characteristics

{{< embed ../../../notebooks/ema_demographics.qmd#fig-demographics >}}

::: {.notes}
UPDATE
:::

-----------------------------------------------------------------------------

## Ecological Momentary Assessments 
 
::: {.columns}
:::: {.column width="60%"}
![risk1_ema_questions.png](https://github.com/jjcurtin/lectures/blob/main/images/risk1_ema_questions.png?raw=true){.absolute width="60%" top="15%" height="auto"}\    
::::

:::: {.column width="30%"}
- Current
  - Craving
  - Affect
  - Risky situations
  - Stressful events
  - Pleasant events

- Future
  - Risky situations
  - Stressful events
  - Confidence
::::
:::

::: {.notes}
UPDATE


So let me tell you a bit more about the 4x daily EMA we collected.  

On each EMA, participants reported the date and time of any lapses back to alcohol use that they hadn’t previously reported. 

All of the EMAs also asked them about their current craving, affective valence and arousal, recent risky situations, and recent stressful and pleasant events since their last EMA.

On the first EMA each day, they also reported any future risky situations and stressful events that they expected in the next week and their confidence that they would remain abstinent. 
:::

-----------------------------------------------------------------------------

## Sensing Feasibility/Acceptability: EMA

::: {.columns}
:::: {.column width="50%"}
- High levels of compliance over 3 months
  - ~ 80% for 4x daily
  - ~ 95% for 1x daily
- Also high compliance for 1 year on NIDA OUD project
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/burden.qmd#fig-ema_compliance >}}
::::
:::

::: {.notes}
**---UPDATE SLIDE NOTES--**
:::

-----------------------------------------------------------------------------

## Sensing Feasibility/Acceptability: EMA

::: {.columns}
:::: {.column width="50%"}
- Collected self-report measures of acceptability
  - The [...]{style="color: gray;"} [interfered]{style="color: orange;"} with my daily activities
  - I [disliked]{style="color: orange;"} the [...]{style="color: gray;"}
  - I would be [willing to use]{style="color: orange;"} the [...]{style="color: gray;"} [for 1 year]{style="color: orange;"} to help with my recovery

\

- Perceptions were neutral or better for most
- Better when provides clinical benefits to users?
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/burden.qmd#fig-ema_sr >}}
::::
:::

::: {.notes}
**---UPDATE SLIDE NOTES--**
:::

-----------------------------------------------------------------------------

## Sensing Feasibility/Acceptability: Geolocation 

::: {.columns}
:::: {.column width="50%"}

- 100% opted-in to provide [geolocation]{style="color: orange;"}
- Very modest ($10/month) financial incentive

\

- Perceptions about sharing geolocation were neutral or better for most
- Better when provides clinical benefits to users?

::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/burden.qmd#fig-gps_sr >}}
::::
:::

::: {.notes}
**---UPDATE SLIDE NOTES--**
:::

-----------------------------------------------------------------------------

## Sensing Feasibility/Acceptability: Communication Logs 

::: {.columns}
:::: {.column width="50%"}

- 150/151 opted-in to provide [communication logs and text message content]{style="color: orange;"} 
- Very modest ($10/month) financial incentive

\

- Perceptions about sharing logs were neutral or better for most
- Better when provides clinical benefits to users?

::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/burden.qmd#fig-logs_sr >}}
::::
:::

::: {.notes}
**---UPDATE SLIDE NOTES--**
:::

-----------------------------------------------------------------------------

## Sensing Feasibility/Acceptability: Text Message Content 

::: {.columns}
:::: {.column width="50%"}
- Essentially same story for sharing text message content
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/burden.qmd#fig-sms_sr >}}
::::
:::

::: {.notes}
**---UPDATE SLIDE NOTES--**
:::

-----------------------------------------------------------------------------
## Modeling: Predictions 

- Predict hour-by-hour probability of [future lapse]{style="color: orange;"}

- Lapse window widths
  - 1 week 
  - 1 day
  - 1 hour 

::: {.notes}
For our purposes today I wont dive deep into the machine learning methods but let me highlight a few high level details 

We used these features I just described to make predictions about the hour-by-hour probability of a future lapse.  We are developing separate models for three future lapse windows – lapses in the next week, lapses in the next day, and lapses in the next hour.  

For example, if I was in recovery from an AUD, I could use these models to generate the probability that I would lapse after this symposium starting at 10am.  One model would generate the probability of a lapse between 10am and 11 am today, the second would predict the probability of a lapse between 10 am today and 10 am tomorrow and the third would provide the probability of a lapse anytime between 10am today and 10 am next Friday  

And of course, all of the models would only use data collected prior to 10 am today so that they are “predicting”, in the full sense of the word, into the future and not just demonstrating an association.
:::

-----------------------------------------------------------------------------

## Modeling: Algorithms and Resampling

- XGBoost - Boosted decision trees
  - ElasticNet GLM (e.g., LASSO, ridge regression)
  - Random Forest
  - KNN

\

- Using grouped (by participant), nested, repeated k-fold CV 
  - 30 test sets
  - New participants and observations not used for training

::: {.notes}
**---UPDATE SLIDE NOTES--**

We are evaluating machine learning model configurations that differ by common statistical algorithms
:::

-----------------------------------------------------------------------------

## Modeling: Area under ROC curve (auROC) 

::: {.columns}
:::: {.column width="50%"}
- 0.50 for random classifier
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/ema_figs_probability.qmd#fig-roc_random >}}
::::
:::

::: {.notes}
**---UPDATE SLIDE NOTES--**
:::

-----------------------------------------------------------------------------

## Modeling: Area under ROC curve (auROC) 

::: {.columns}
:::: {.column width="50%"}
- [0.50 for random classifier]{style="color: gray;"}
- 1.00 for perfect classifer
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/ema_figs_probability.qmd#fig-roc_perfect >}}
::::
:::

::: {.notes}
**---UPDATE SLIDE NOTES--**
:::

-----------------------------------------------------------------------------

## Modeling: Area under ROC curve (auROC) 

::: {.columns}
:::: {.column width="50%"}
- [0.50 for random classifier]{style="color: gray;"}
- [1.00 for perfect classifer]{style="color: gray;"}
- Likelihood that model will assign a higher lapse probability to randomly selected lapse vs. no-lapse observation
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/ema_figs_probability.qmd#fig-roc_perfect >}}
::::
:::

::: {.notes}
**---UPDATE SLIDE NOTES--**
:::

-----------------------------------------------------------------------------

## Modeling: Feature Engineering 

- Features based on recent past experiences (12, 24, 48, 72, 168 hours)

- Min, max, and median response (all items)

- History (count) of past lapses (item 1) and completed EMAs (compliance)

- Raw scores and change scores (from baseline/all past responses)

::: {.notes}
We used these raw EMAs to engineer about 300 features to use in machine learning models to predict future lapses

We formed features by aggregating EMA items over various past time periods ranging from 12 -168 hours in the past

We calculated mins, maxes and medians for the EMA items in these time periods

We also calculated counts of past lapses and counts of past EMAs completed to index engagment with our monitoring system.

And we included these scores both in raw form and as change from baselines for the participant based on all their previous responses since the start of the study.
:::

-----------------------------------------------------------------------------

## 1 Week: Probabilities for No Lapse and Lapse

::: {.columns}
:::: {.column width="60%"}
- Model predicts [probability]{style="color: orange;"} of lapse in next week for “[new]{style="color: orange;"}” observations in test sets

- Can panel predictions by [Ground Truth]{style="color: orange;"} (i.e., true lapse vs. no lapse observations

- Want high probabilities to be high for true lapses and low for true no lapses
::::

:::: {.column width="40%"}
<!--Lapse Probability by Ground Truth"-->
{{< embed ../../../notebooks/ema_figs_probability.qmd#fig-week-no_dec_thres >}}
::::
:::

::: {.notes}
Ok, lets start with the model that provides the coarsest level of temporal specificity – 1 week, and let me take a moment to make the predictions that this machine learning model provides more concrete for you

On the right, you are looking at histograms of the lapse probability predictions that the model makes for all the weeks for all the patients in the held out folds.   

I’ve paneled these histograms by whether a lapse did or did not happen in reality for each predicted week.  The top panel is for weeks with lapses and the bottom panel is for weeks with no lapses.

Ideally, you want the predicted probabilities to be very high for weeks when there was a lapse and very low for weeks when there was no lapse.    

And this is exactly what we see for the one week lapse window model
:::

-----------------------------------------------------------------------------

## 1 Week: ROC Curve

::: {.columns}
:::: {.column width="50%"}
Model auROCs

- Next week = [0.90]{style="color: orange;"}; [0.88 - 0.91]

:::::{.callout-tip icon=false}
## Coarse rules of thumb for auROC 
.70 - .80 are considered fair  
.80 - .90 are considered good  
\> .90 are considered excellent  
:::::
::::

:::: {.column width="50%"}
<!--ROC Curve for Week-->
{{< embed ../../../notebooks/ema_figs_probability.qmd#fig-roc_week >}}
::::
:::

::: {.notes}
But as I said, depending on the application, we may not want to always use a .5 decision threshold.  And this is where the ROC curve and the area under this curve come into play as a performance metric.   The ROC curve is a plot of the model’s sensitivity by its specificity across all possible decision thresholds.

The area under this curve can range from approximately .5 for a random classifier to 1.0 for a classifier that performs perfectly.  

And the AUC for our 1 week model is .90, which is generally considered excellent performance.  
:::

-----------------------------------------------------------------------------

## 1 Day: ROC Curve

::: {.columns}
:::: {.column width="50%"}
Model auROCs

- Next week = [0.90]{style="color: orange;"}; [0.88 - 0.91]

:::::{.callout-tip icon=false}
## Coarse rules of thumb for auROC 
.70 - .80 are considered fair  
.80 - .90 are considered good  
\> .90 are considered excellent  
:::::
::::

:::: {.column width="50%"}
<!--Blank-->
::::
:::

::: {.notes}
So we were very encouraged by the performance of this model because it exceeded the performance of the only other published week level lapse prediction model that we were aware of.   

But we were also eager to see how well we could do if we required a higher level of temporal precision by developing a day level model.
:::

-----------------------------------------------------------------------------


## 1 Day: ROC Curve

::: {.columns}
:::: {.column width="50%"}
Model auROCs

- Next week = [0.90]{style="color: orange;"}; [0.88 - 0.91]
- Next day  = [0.91]{style="color: green;"}; [0.89 - 0.92]

:::::{.callout-tip icon=false}
## Coarse rules of thumb for auROC 
.70 - .80 are considered fair  
.80 - .90 are considered good  
\> .90 are considered excellent  
:::::
::::

:::: {.column width="50%"}
<!--ROC Curve for Week & Day-->
{{< embed ../../../notebooks/ema_figs_probability.qmd#fig-roc_week_day >}}
::::
:::

::: {.notes}
And here is the ROC curve and the AUC for the day level model in green, superimposed on the week level model in orange

The day level model performed as well as, if not better, than the week level model with an AUC of .91

[PAUSE]
:::

-----------------------------------------------------------------------------

## 1 Hour: ROC Curve

::: {.columns}
:::: {.column width="50%"}
Model auROCs

- Next week = [0.90]{style="color: orange;"}; [0.88 - 0.91]
- Next day  = [0.91]{style="color: green;"}; [0.89 - 0.92]
- Next hour = [0.93]{style="color: blue;"}; [0.92 - 0.94]

:::::{.callout-tip icon=false}
## Coarse rules of thumb for auROC 
.70 - .80 are considered fair  
.80 - .90 are considered good  
\> .90 are considered excellent  
:::::
::::

:::: {.column width="50%"}
<!--ROC Curve for All-->
{{< embed ../../../notebooks/ema_figs_probability.qmd#fig-roc_all >}}
::::
:::

::: {.notes}
And it turns out that we can do somewhat better still with hour level predictions.  Here the blue curve represents the ROC curve for the hour level model, which had the best AUC yet, .93

[PAUSE]
:::

-----------------------------------------------------------------------------

## Algorithmic Fairness

::: {.columns}
:::: {.column width="35%"}
- Substantially poorer performance if not white/non-hispanic
- Meaningfully poorer performance for other less priviledged groups
- Not just due to under-representation in training data

\

- Move beyond binary comparisons
- Methods to remediate?
::::

:::: {.column width="65%"}
{{< embed ../../../notebooks/fairema.qmd#fig-fair >}}
::::
:::

::: {.notes}
UPDATE
:::

-----------------------------------------------------------------------------

## Global Feature Importance

::: {.columns}
:::: {.column width="50%"}
- All EMA items impact lapse probability (both globally and locally)
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/ema_figs_shaps.qmd#fig-global >}}
::::
:::

::: {.notes}
UPDATE

In the spirit of making this model more transparent and interpretable, lets briefly look under the hood at the feature importance

The plot on the right shows feature names and their associated importance indexed by mean absolute SHAP values over all observations.  From this we see a few important characteristics of the model.   

First, all of EMA items affect predictions about lapse probability globally across observations  As you might expect, history of past lapses has a big influence on the probability of a future lapse.  But self reported abstinence efficacy, craving, history of stress events and other features from the EMA all make meaningful contributions to lapse probability across observations.  

To make these values somewhat meaningful for you, let me remind you these Sh
[logodds of .4 = 1.5 odds;  logodds of .7 = double the odds]
:::

-----------------------------------------------------------------------------

## Global Feature Importance

::: {.columns}
:::: {.column width="50%"}
- [All EMA items impact lapse probability (both globally and locally)]{style="color: grey;"}
- Lapse day and Lapse hour are useful for day and hour level models as expected
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/ema_figs_shaps.qmd#fig-global >}}
::::
:::

::: {.notes}
We also see that demographics were not particularly important for prediction lapses for these models.   However, I'll return later to acknowledged that we had limited race/ethnicity diversity in the sample.  Nonetheless, we had reasonable variable on other participant characteristics like sex, SES, education, and addiction severity.  

And finally, we see that we can use lapse day and lapse hour to make predictions with the more temporally precise models.  Not surprisingly, people are more likely to lapse on weekends and during evening hours and the associated day and hour level models models can use that information to improve their lapse predictions.  These features likely contribute to the superior performance of the hour and to a lesser extent the day model relative to the week interval prediction model.
:::

-----------------------------------------------------------------------------

## Global Feature Importance

::: {.columns}
:::: {.column width="50%"}
- [All EMA items impact lapse probability (both globally and locally)]{style="color: grey;"}
- [Lapse day and Lapse hour are useful for day and hour level models as expected]{style="color: grey;"}
- Demographics not particularly important (but limited race/ethnic diversity)
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/ema_figs_shaps.qmd#fig-global >}}
::::
:::

::: {.notes}
We also see that demographics were not particularly important for prediction lapses for these models.   However, I'll return later to acknowledged that we had limited race/ethnicity diversity in the sample.  Nonetheless, we had reasonable variable on other participant characteristics like sex, SES, education, and addiction severity.  

And finally, we see that we can use lapse day and lapse hour to make predictions with the more temporally precise models.  Not surprisingly, people are more likely to lapse on weekends and during evening hours and the associated day and hour level models models can use that information to improve their lapse predictions.  These features likely contribute to the superior performance of the hour and to a lesser extent the day model relative to the week interval prediction model.
:::

-----------------------------------------------------------------------------

## Clinical Uses: DO NOT Predict Lapses

::: {.columns}
:::: {.column width="50%"}
DO NOT predict class labels  (Lapse vs. No-Lapse)

- Iatriogenic effects?
- Information loss
::::

:::: {.column width="50%"}
<!--Blank-->
::::
:::

::: {.notes}
UPDATE
:::

-----------------------------------------------------------------------------

## Clinical Uses: DO NOT Predict Lapses

::: {.columns}
:::: {.column width="45%"}
DO NOT predict class labels  (Lapse vs. No-Lapse)

- [Iatriogenic effects]{style="color: gray;"}
- [Information loss?]{style="color: gray;"}
- Low positive predictive values 
  - Lapses on only ~7% of days
  - Spec and Sens > 0.80
  - PPV ~ 0.27
::::

:::: {.column width="55%"}
{{< embed ../../../notebooks/ema_figs_probability.qmd#fig-cm_day >}}
::::
:::

::: {.notes}
UPDATE
:::

-----------------------------------------------------------------------------

## Clinical Uses: DO Use Lapse Probabilities

::: {.columns}
:::: {.column width="50%"}
DO use lapse probability

- auROCs range from 0.90 - 0.93
::::

:::: {.column width="50%"}
<!-- blank  -->
::::
:::

::: {.notes}
INSERT NOTES
:::

-----------------------------------------------------------------------------

## Clinical Uses: DO Use Lapse Probabilities

::: {.columns}
:::: {.column width="50%"}
DO use lapse probability

- [auROCs range from 0.90 - 0.93]{style="color: gray;"}
- Probabilities are calibrated and ordinal
- Provides fine gradations of relative risk for clinical decision-making
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/ema_figs_probability.qmd#fig-calibration_plot_day >}}
::::
:::

::: {.notes}
INSERT NOTES
:::

-----------------------------------------------------------------------------

## Clinical Uses: Who and When?

::: {.columns}
:::: {.column width="50%"}
- Day and Hour models can be used for "just-in-time" interventions
::::

:::: {.column width="50%"}
<!-- blank  -->
::::
:::

::: {.notes}
INSERT NOTES
:::

-----------------------------------------------------------------------------

## Clinical Uses: Who and When?

::: {.columns}
:::: {.column width="50%"}
- [Day and Hour prediction windows can be used for "just-in-time" interventions]{style="color: gray;"}
- Week window may be too coarse for JIT
- Push week window further into the future to support outside of DTx 
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/lag_auroc.qmd#fig-lag_auroc >}}
::::
:::

::: {.notes}
INSERT NOTES
:::

-----------------------------------------------------------------------------

## Clinical Uses: Which Interventions/Supports?

::: {.columns}
:::: {.column width="50%"}
- Tools from interpretable AI can help explain [why]{style="color: orange;"} a future lapse is expected
::::

:::: {.column width="50%"}
<!--blank-->
::::
:::

::: {.notes}

:::

-----------------------------------------------------------------------------

## Clinical Uses: Which Interventions/Supports?

::: {.columns}
:::: {.column width="50%"}
- [Tools from interpretable AI can help explain why a future lapse is expected]{style="color: gray;"}
- Local SHAP values highlight important risk features for a [specific individual at a specific moment in time]{style="color: orange;"}
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/ema_figs_shaps.qmd#fig-local_day_emaonly >}}
::::
:::

::: {.notes}
UPDATE

In the bottom right figure, I am showing you local SHAP values from the next hour risk prediction model. These SHAP values allow us to know which features contributed most strongly to each individual lapse risk prediction, in other words a prediction for a specific individual at a specific time.
:::

-----------------------------------------------------------------------------

## Clinical Uses: Which Interventions/Supports?

::: {.columns}
:::: {.column width="50%"}
- [Tools from interpretable AI can help explain why a future lapse is expected]{style="color: gray;"}
- [Local SHAP values highlight important risk features for a specific individual at a specific moment in time{style="color: gray;"}
- If we know why, we can begin to [recommend interventions and supports]{style="color: orange;"} to address these risks
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/ema_figs_shaps.qmd#fig-local_day_emaonly >}}
::::
:::

::: {.notes}
- For example, today one DTx user may show a high lapse probability and the model may have assigned that probability because they have been craving a lot recently. For that person, we could recommend urge surfing techniques and provide them support doing it within the DTx. 

- A second person might have similarly high lapse probability but instead because they have lapsed a few times in recent weeks. They could be encouraged to complete activities designed to increase their motivation for abstinence. 

- A third person might have a low probability of lapsing because they have reported many recent positive activities. No intervention might be needed for this person but they could receive feedback about how their commitment to their well-being was paying off for their recovery.
:::

-----------------------------------------------------------------------------

## Clinical Uses: Which Interventions/Supports?

::: {.columns}
:::: {.column width="50%"}
- [Tools from interpretable AI can help explain why a future lapse is expected]{style="color: gray;"}
- [Local SHAP values highlight important risk features for a specific individual at a specific moment in time{style="color: gray;"}
- If we know why, we can begin to [recommend interventions and supports]{style="color: orange;"} to address these risks
::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/ema_figs_shaps.qmd#fig-local_day_emaonly >}}
::::
:::

::: {.notes}
As a starting point, the mapping between between important local risk features and specific interventions or supports could be created using clinical domain expertise. In other words, what would a clinician tell their patient to do in those circumstances. We can simply hard code these clinically derived mappings between risk features and support recommendations in the Smart DTx

However, with enough training data, reinforcement learning can also be applied to this problem to allow the model to learn the best intervention to recommend given a set of risk features to reduce subsequent lapse probability.
:::

-----------------------------------------------------------------------------
## (Selective) Next Steps: Passive Sensing 


Use geolocation and cellular communications

- Lower sensing burden
- More (distinct) risk features for intervention recommendations

::: {.notes}
As the sensing and recommendation system continues to mature, we will want a richer, broader set of lapse risk features so that we can distinguish better between different situations that require different supports. We can do this by engineering features from our location and communication signals, which tap into different experiences than what we measure by EMA.

One of the key next steps is to develop models that rely more on passive sensing rather than EMA to lower the patient burden of using these systems long term and to gain access to signals that may not be available by self-report.

Let's take a look at two of the more revealing personal sensing methods that we are developing to provide you with some intuition about how we think this will work.




:::

-----------------------------------------------------------------------------

## {#gps_detection_1 data-menu-title="GPS detection, wide view" background-image="https://dionysus.psych.wisc.edu/present/meet_faculty/images/john_gps_wide.png" background-size="100%" background-position="bottom" background-repeat="none"}


::: {.notes}
Here is a wide view of my moment-by-moment location detected by a GPS app over a month when we were first experimenting with this sensing method.  The app recorded the paths that I traveled, with movement by car in green and running in blue.

The red dots indicate places that I stopped to visit for at least a few minutes.

And although not displayed here, the app recorded the days and exact times that I was at each of these locations.

From these data, you can immediately see that I am runner, with long runs leaving from downtown Madison and frequent trail runs on the weekends in the county and state parks to the west and northwest.
:::

-----------------------------------------------------------------------------

## {#gps_detection_2 data-menu-title="GPS detection, zoomed" background-image="https://dionysus.psych.wisc.edu/present/meet_faculty/images/john_gps_zoom.png" background-size="100%" background-position="bottom" background-repeat="none"}


::: {.notes}
Zooming in to the Madison isthmus, these data show that I drove my children halfway around the lake each morning to their elementary school.  And from these data we might be able to detect those stressful mornings when getting my young kids dressed and fed didn't go as planned and we were late, sometimes **very late**, to school!

The app recorded my daily running commute through downtown Madison to and from my office.  From this, we can observe my longs days at the office and also those days that I skipped out.

Looking at the red dots indicating the places I visit, the app can detect the restaurants, bars, and coffee shops where I eat, drink and socialize.  We can use public map data to identify these places and make inferences about what I do there.
:::

-----------------------------------------------------------------------------

## ...Imagine my text messages...

![smartphone_uber.png](https://github.com/jjcurtin/lectures/blob/main/images/smartphone_uber.png?raw=true){.absolute top="15%" left="33%" width="33%" height="auto"}\ 

::: {.notes}
In addition to geolocation, we also collected my smartphone communications logs and even the content of my text messages.

And no such luck, I don't plan to show you my actual text messages!

But imagine what we could learn about me from the patterns of my communications - Who I was calling, when I made those calls, and even the content of what I sent and received by text message.
:::

-----------------------------------------------------------------------------

## Context is Critical

<!--intentional blank page-->

::: {.notes}
We believe we can improve the predictive strength of these geolocation and communication signals even further by identifying the specific people and places that make us happy or sad or stressed, those that we perceive support our mental health and recovery and those who undermine it.
:::

-----------------------------------------------------------------------------

## Context is Critical
![smartphone_context.png](https://github.com/jjcurtin/lectures/blob/main/images/smartphone_context.png?raw=true){.absolute top="15%" left="33%" width="33%" height="auto"}\ 

::: {.notes}
For example, consider the implications of this brief text message thread between a hypothetical patient and their drinking buddy for what you might predict for the probability that they might lapse back to drinking in the coming hours.   

... And how would your prediction change if this wasn’t their drinking buddy but instead, their mom who was a big supporter of their recovery.

This interpersonal context matters!!!
:::

-----------------------------------------------------------------------------

## Context is Critical

<!--intentional blank page-->


::: {.notes}
We can gather this contextual information quickly by asking a few key questions about the people and places we interact with frequently over the first couple of months that we record these signals.  And we can identify these frequent contacts and locations directly from these signals.

In our current projects, we target people and places that we interact with at least twice a month or more for more detailed follow-up to gather context.    And it turns out that this really isn’t that burdensome.   Most of us are creatures of habit and if we set a threshold for 2x monthly interactions, we typically only have 10-30 people and places that meet this threshold.   And it’s the same people and places each month so we can build this context up when the person first starts to use the system and after that it only needs to be updated occasionally when we go somewhere new or make a new friend.
:::

-----------------------------------------------------------------------------

## Contextualized Geolocation

![context_gps.png](https://github.com/jjcurtin/lectures/blob/main/images/context_gps.png?raw=true){width="75%"}\ 

::: {.notes}
UPDATE
:::

-----------------------------------------------------------------------------

## Contextualized Communications

![context_cell.png](https://github.com/jjcurtin/lectures/blob/main/images/context_cell.png?raw=true){width="75%"}\ 

::: {.notes}
UPDATE
To be clear, we have only just begun to train models using GPS.   We have started by focusing on recent locations…..
DESCRIBE MORE


There is clearly predictive signal in the geolocation signal but not enough to stand alone as the only features at this point.   We are seeing AUCs in the low .7s when we use only geolocation to predict future lapses.  

However, when we add GPS to the EMA models that I described today, we appear to need fewer unique EMA items to get the same level of model performance.   So the addition of GPS may serve to lower patient burden while maintaining model performance.

The story is pretty much the same right now for cellular communications as well.   At this point we have only worked with the meta data – the contact numbers, call times, durations, etc – combined with context.   We haven’t yet done anything with the text message content.   And models built from the meta data perform about as well at these preliminary GPS models.

But we are hoping to extract more signal from the both of these as we continue to work on feature engineering with it.
:::

-----------------------------------------------------------------------------

## (Selective) Next Steps

- [Use geolocation and cellular communications]{style="color: gray;"}
- Improve algorithmic fairness
  - Improve assessment of fairness
  - Explore computational solutions
  - More diversity in training data

::: {.notes}
We are excited by the early performance of these machine learning models BUT I want to be clear that these are preliminary research studies.  And they included mostly white participants from our local community in Madison, WI.  

Models trained on these participants would be unlikely to work well with black and brown patients or patients from rural communities.  

Machine learning models must be trained on diverse samples of patients or their use may exacerbate rather than reduce existing mental healthcare disparities. 
:::

-----------------------------------------------------------------------------

## Active Project: Lapse in patients with Opioid Use Disorder 

::: {.medium}
- Recruiting ~ 400 patients in recovery from Opioid Use Disorder 
- National sample (size; diversity: demographics, location)
- More variation in stage of recover (1 – 6 months at start)
- 12 months of monitoring
- Closer to real implementation methods
:::

::: {.columns}

:::: {.column width="60%"}
![risk2_pis.png](https://github.com/jjcurtin/lectures/blob/main/images/risk2_pis.png?raw=true)\ 
::::

:::: {.column width="40%"}
![nida_logo.png](https://github.com/jjcurtin/lectures/blob/main/images/nida_logo.png?raw=true)\ 
::::
:::


::: {.notes}
We are now collecting data for a NIDA funded project where we are specifically recruiting for racial, ethnic, and geographic diversity across the entire United States.


We are also recruiting for people at different stages in their recovery and following them for a longer period of time – up to 12 months
:::

-----------------------------------------------------------------------------

## (Selective) Next Steps

- [Use geolocation and cellular communications]{style="color: gray;"}
- [Improve algorithmic fairness]{style="color: gray;"}
- Optimize algorithmic feedback to increase trust


::: {.notes}
Of course, accurately predicting future lapses is only useful if these predictions can be used to sustain engagement with treatments and improve clinical outcomes.  

We have now started to consider how we can use these predictions to help patients personalize their use of a digital therapeutic.  

These models may be able to suggest when more use of the DTx is needed because lapse risk is increasing or high but we are also hoping that we can use the models to recommend which tools and supports in the DTx are best for that patient at that moment in time given their lapse risk probability and important features contributing to the lapse prediction.

We are also sensitive to the fact that these recommendations from the machine learning models will need to be provided to patients in a transparent manner that also encourages them to trust the algorithm and follow its recommendations.  
:::


-----------------------------------------------------------------------------

## Optimize Algorithmic Feedback in Smart DTx

- Daily updates from Day model based on EMA and and geolocation features
  - Lapse probability for that day
  - Recent trends in lapse probabilitity 
  - Locally important features for that day

- Manipulate algorithmic transparency in daily message

- Measure trust, risk-relevant engagement, and clinical outcomes

![niaaa_logo.png](https://github.com/jjcurtin/lectures/blob/main/images/niaaa_logo.png?raw=true){.absolute bottom="5%" right="2%" width="auto" height="auto"}\ 

::: {.notes}

:::

-----------------------------------------------------------------------------

## (Selective) Next Steps

- [Use geolocation and cellular communications]{style="color: gray;"}
- [Improve algorithmic fairness]{style="color: gray;"}
- [Optimize algorithmic feedback to increase trust]{style="color: gray;"}
- Consider other precision mental health applications


::: {.notes}
:::

-----------------------------------------------------------------------------

## Precision Mental Health without Sensing

::: {.columns}
:::: {.column width="50%"}
- Large dataset from an RCT of first line medications for smoking cessation
  - Varenicline (e.g., Chantix)
  - NRT patch
  - Combo NRT (patch and lozenge)
  
- Measured point prevalence abstinence
  - 4 weeks
  - 12 weeks (end of treatment)
  - 26 weeks (long term follow-up) 
::::

:::: {.column width="50%"}
<!-- BLANK -->
::::
:::

::: {.notes}
UPDATE
:::

-----------------------------------------------------------------------------

## Precision Mental Health without Sensing

::: {.columns}
:::: {.column width="50%"}
- Sample was very well-characterized at baseline  
  - Smoking history
  - Personality and other individual differences
  - Environment and social network

\

- Trained a model to predict abstinence
  - Many, many features
  - Included Medication X Feature interactions
  - Predict smoker abstinence probability for each medication 
::::

:::: {.column width="50%"}
<!-- BLANK -->
::::
:::

::: {.notes}
UPDATE
:::

-----------------------------------------------------------------------------

## Precision Mental Health without Sensing

::: {.columns}
:::: {.column width="50%"}

::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/match_figs.qmd#fig-wk4 >}}
::::
:::

::: {.notes}
UPDATE
:::

-----------------------------------------------------------------------------

## Precision Mental Health without Sensing

::: {.columns}
:::: {.column width="50%"}

::::

:::: {.column width="50%"}
{{< embed ../../../notebooks/match_figs.qmd#fig-all >}}
::::
:::

::: {.notes}
UPDATE
:::

-----------------------------------------------------------------------------
## CRediTs

![credits.png](https://github.com/jjcurtin/lectures/blob/main/images/credits_risk1.png?raw=true){.absolute bottom="0%" left="5%" width="92%" height="auto"}\ 